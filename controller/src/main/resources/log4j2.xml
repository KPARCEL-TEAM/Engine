<?xml version="1.0" encoding="UTF-8"?>

<!-- status 设置log4j2自身内部的信息输出，可以不设置-->
<!-- monitorInterval 自动检测配置的时间间隔(单位：秒), 有修改进行更新 -->
<configuration status="WARN" monitorInterval="60">

    <properties>
        <property name="LOG_PATH">../log</property>
        <property name="LOG_NAME">web</property>
        <property name="ROOT_LOG_LEAVE">INFO</property>
        <property name="LOG_PATTERN">%d{yyy-MM-dd HH:mm:ss} [%t] %-5level %logger{80}[%L] - %msg%n</property>
    </properties>

    <appenders>
        <!-- 控制台输出 -->
        <console name="console" target="SYSTEM_OUT">
            <patternLayout pattern="${LOG_PATTERN}" />
        </console>

        <!-- 日志回滚 -->
        <RollingFile name="dailyRollingFile" fileName="${LOG_PATH}/${LOG_NAME}.log"
            filePattern="${LOG_PATH}/${LOG_NAME}-%d{yyyy-MM-dd}-%i.log.gz">
            <patternLayout pattern="${LOG_PATTERN}" />

            <Policies>
                <!-- 0 点回滚-->
                <TimeBasedTriggeringPolicy />
                <!-- 日志体积超过 100M 回滚 -->
                <SizeBasedTriggeringPolicy size="250MB"/>
                <!-- 项目启动时, 已有的日志文件的最后修改时间, 当前时间, corn 表达式三者一起判断是否需要回滚 -->
                <CronTriggeringPolicy schedule="0 0 0 * * ?" evaluateOnStartup="true"/>

            </Policies>

            <DefaultRolloverStrategy>
                <!-- 自动删除超过 30 天的日志(以最后的修改时间为准)-->
                <Delete basePath="${LOG_PATH}" maxDepth="2">
                    <IfLastModified age="30d"/>
                    <IfFileName glob="*.log.gz" />
                </Delete>
            </DefaultRolloverStrategy>

        </RollingFile>
    </appenders>

    <loggers>
        <!--根配置-->
        <root level="${ROOT_LOG_LEAVE}">
            <appender-ref ref="console"/>
            <appender-ref ref="dailyRollingFile" />
        </root>
    </loggers>

</configuration>
